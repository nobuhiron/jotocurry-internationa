---
import SectionTitle from '../components/SectionTitle.astro';
import StatCard from '../components/StatCard.astro';
import Button from '../components/Button.astro';
import placeholderImage from '../assets/images/Placeholder Image.jpg';
import { getStats } from '../lib/microcms-stats';
import { getTranslation } from '../data/translations';
import type { Locale } from '../lib/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'ja' } = Astro.props;
const brandPowerText = getTranslation('brandPower', locale);

// 統計情報を取得（フォールバック値あり）
let mealsValue = 5000; // デフォルト値（翻訳データの値）
let domesticStoreCount = 44; // デフォルト値
let overseasStoreCount = 11; // デフォルト値

try {
  const stats = await getStats();
  mealsValue = stats.mealsValue;
  domesticStoreCount = stats.domesticStoreCount;
  overseasStoreCount = stats.overseasStoreCount;
} catch (error) {
  console.warn('microCMSから統計情報を取得できませんでした。デフォルト値を使用します。', error);
}
---

<section class="p-brand-power l-section" data-bg="white" id="section-brand-power">
  <div class="l-container">
    <div class="p-brand-power__inner l-section__inner">
      <SectionTitle
        title={brandPowerText.title}
        class="p-brand-power__title"
      />
      <p class="p-brand-power__description">{brandPowerText.description}</p>
      <div class="p-brand-power__stats">
        <StatCard
          value={String(mealsValue)}
          unit={brandPowerText.stats.meals.unit}
          label={brandPowerText.stats.meals.label}
          class="p-brand-power__stat"
        />
        <StatCard
          value={String(domesticStoreCount)}
          unit={brandPowerText.stats.domesticStores.unit}
          label={brandPowerText.stats.domesticStores.label}
          class="p-brand-power__stat"
        />
        <StatCard
          value={String(overseasStoreCount)}
          unit={brandPowerText.stats.overseasStores.unit}
          label={brandPowerText.stats.overseasStores.label}
          class="p-brand-power__stat"
        />
      </div>
    </div>
  </div>
  <div class="p-brand-power__carousel-wrapper">
    <div class="p-brand-power__carousel splide" id="brand-power-carousel">
      <div class="splide__track">
        <ul class="splide__list">
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
          <li class="splide__slide">
            <div class="p-brand-power__slide">
              <img
                src={placeholderImage.src}
                alt={locale === 'en' ? 'Store noren' : '店舗のれん'}
                class="p-brand-power__slide-image"
              />
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="l-container">
    <div class="p-brand-power__button-wrapper">
      <Button
        text={brandPowerText.button}
        variant="secondary"
        icon="→"
        class="p-brand-power__button"
      />
    </div>
  </div>
</section>

<script>
  import initBrandPower from '../scripts/brand-power.js';

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBrandPower);
  } else {
    initBrandPower();
  }
</script>

